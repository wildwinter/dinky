"use strict";const{app:e,BrowserWindow:c,Menu:l,dialog:u}=require("electron"),a=require("path"),h=require("fs/promises");e.setName("Dinky");function s(){const o=new c({title:"Dinky",width:800,height:600,webPreferences:{preload:a.join(__dirname,"preload.js"),nodeIntegration:!1,contextIsolation:!0}}),r=process.platform==="darwin",d=[...r?[{label:e.name,submenu:[{role:"about"},{type:"separator"},{role:"services"},{type:"separator"},{role:"hide"},{role:"hideOthers"},{role:"unhide"},{type:"separator"},{role:"quit"}]}]:[],{label:"File",submenu:[{label:"Open...",accelerator:"CmdOrCtrl+O",click:async()=>{const{canceled:n,filePaths:t}=await u.showOpenDialog(o,{properties:["openFile"],filters:[{name:"Ink Files",extensions:["ink"]}]});if(!n&&t.length>0)try{const i=await h.readFile(t[0],{encoding:"utf-8"});o.webContents.send("file-opened",i)}catch(i){console.error("Failed to read file:",i)}}},r?{label:"Close",role:"close"}:{role:"quit"}]}],p=l.buildFromTemplate(d);if(l.setApplicationMenu(p),process.env.VITE_DEV_SERVER_URL)o.loadURL(process.env.VITE_DEV_SERVER_URL);else{const n=a.join(__dirname,"../dist/index.html");o.loadFile(n).catch(t=>console.error("Failed to load index.html:",t))}}e.whenReady().then(()=>{s(),e.on("activate",()=>{c.getAllWindows().length===0&&s()})});e.on("window-all-closed",()=>{process.platform!=="darwin"&&e.quit()});
